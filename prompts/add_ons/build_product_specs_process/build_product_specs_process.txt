[[START OF 'BUILD_PRODUCT_SPECS_PROCESS_ADDON' v0.2: Instructions for AI Product Specification Generation with Iterative Deepening]]

**Overall Goal:** To analyze provided input documents and guidance materials, and then generate a comprehensive set of product specification documents by performing deep research focused on the headings of a primary input document. This process supports iterative deepening across multiple runs.

---
### Phase 1: Initialization and Setup

1.  **Acknowledge Process:** Your primary objective is to execute the "Build Product Specifications Process."
2.  **Retrieve Configuration Variables:**
    *   You must identify and understand the following variables defined by the user in the `[[USER PATH CONFIGURATION]]` block of the main prompt:
        *   `PRODUCT_NAME`
        *   `PRODUCT_SPECS_INPUT_DOCS_PATH`
        *   `PRODUCT_SPECS_GUIDANCE_DOCS_PATH`
        *   `PRODUCT_SPECS_OUTPUT_PATH` (This is where outputs for the *current* iteration will be saved)
        *   `PRODUCT_SPECS_PRIMARY_INPUT_FILE` (Optional)
        *   `PRODUCT_SPECS_REF_DEPTH` (Optional, 0-2, defaults to 1 for document-to-document references)
        *   `PRODUCT_SPECS_CODEBASE_REVIEW_PREFERENCE` (Optional, "complex", "cursory", "focused", defaults to "cursory")
        *   `PRODUCT_SPECS_CODEBASE_FOCUS_AREAS` (Optional, for "focused" codebase review)
        *   `PRODUCT_SPECS_ITERATION_DEPTH` (Optional, 0-3, defaults to 0)
        *   `PRODUCT_SPECS_PREVIOUS_ITERATION_OUTPUT_PATH` (Optional, path to previous iteration's outputs)
3.  **Validate Configuration Values & Determine Iteration Context:**
    *   **`Current_Iteration_Depth`**: Validate `PRODUCT_SPECS_ITERATION_DEPTH`. If not specified, or invalid (not an integer 0-3), default to `0`. State the `Current_Iteration_Depth` you are using.
    *   **`Max_Ref_Depth`**: Validate `PRODUCT_SPECS_REF_DEPTH`. If not specified, or invalid (not an integer 0-2), default to `1`.
    *   **`Code_Review_Preference`**: Validate `PRODUCT_SPECS_CODEBASE_REVIEW_PREFERENCE`. If not specified, or invalid (not "complex", "cursory", or "focused"), default to "cursory".
    *   **`Previous_Iteration_Path`**: This is `PRODUCT_SPECS_PREVIOUS_ITERATION_OUTPUT_PATH`. If `Current_Iteration_Depth` is 1, 2, or 3, this path **must** be provided and point to an accessible folder containing the outputs of the previous iteration. If it's missing or inaccessible under these conditions, report this as a CRITICAL ERROR and HALT processing. For `Current_Iteration_Depth` 0, this path is not strictly required and can be ignored if empty.
    *   Note other paths and variables: `PRODUCT_NAME`, `PRODUCT_SPECS_INPUT_DOCS_PATH`, `PRODUCT_SPECS_GUIDANCE_DOCS_PATH`, `PRODUCT_SPECS_OUTPUT_PATH`, `PRODUCT_SPECS_PRIMARY_INPUT_FILE`, `PRODUCT_SPECS_CODEBASE_FOCUS_AREAS`.
4.  **Determine Output File Suffix:**
    *   Based on `Current_Iteration_Depth`, determine the suffix for output files: `_D0.md`, `_D1.md`, `_D2.md`, or `_D3.md`. This will be used in Phase 6. E.g., if `Current_Iteration_Depth` is 0, output files will be like `{PRODUCT_NAME}_product_specification_D0.md`.

---
### Phase 2: Input Processing (Conditional on Iteration Depth)

**A. For `Current_Iteration_Depth` 0 (Outline Generation):**
    1.  **Process Initial Input Documents:**
        *   Thoroughly read, parse, and understand all documents from `PRODUCT_SPECS_INPUT_DOCS_PATH`.
        *   Thoroughly read, parse, and understand all documents from `PRODUCT_SPECS_GUIDANCE_DOCS_PATH`.
    2.  **Identify Primary Input Document:**
        a.  If `PRODUCT_SPECS_PRIMARY_INPUT_FILE` was specified and is accessible from the read documents, designate it as your 'Primary Input Document'.
        b.  If not specified or inaccessible, select the most comprehensive/foundational document from those read from `PRODUCT_SPECS_INPUT_DOCS_PATH` to be the 'Primary Input Document'. State your choice and rationale.
        c.  CRITICAL ERROR: If no Primary Input Document can be determined (no inputs or specified primary is inaccessible), HALT and report.
    3.  Store the content of the 'Primary Input Document' and all other supporting input/guidance documents for use in research.

**B. For `Current_Iteration_Depth` 1, 2, or 3 (Iterative Elaboration):**
    1.  **Process Previous Iteration's Output Documents:**
        *   You MUST read and parse all `*_D[Current_Iteration_Depth - 1].md` documents (e.g., `*_D0.md` if current depth is 1) from the `Previous_Iteration_Path`. These are your primary input for this iteration.
        *   CRITICAL ERROR: If these documents are not found or are inaccessible, HALT and report.
    2.  **Process Original Input & Guidance Documents (As Reference):**
        *   Re-read/ensure you have access to the original documents from `PRODUCT_SPECS_INPUT_DOCS_PATH` and `PRODUCT_SPECS_GUIDANCE_DOCS_PATH`. These serve as reference material to ensure consistency and to draw further details from if needed during elaboration, but your main focus is expanding the previous iteration's documents.
    3.  The 'Primary Input Document' for these iterations is effectively the set of documents from the previous iteration, particularly the main specification document (e.g., `{PRODUCT_NAME}_product_specification_D[Current_Iteration_Depth - 1].md`).

---
### Phase 3: Content Generation (Conditional on Iteration Depth)

**A. If `Current_Iteration_Depth` is 0 ("Outline Generation"):**

    **i. Overall Primary Input Document Review & Initial Theme Identification:**
        Conduct a high-level review of the entire 'Primary Input Document' (identified in Phase 2.A.2). Understand its structure and identify broad, top-level research themes.

    **ii. Per-Heading Deep Dive Cycle (Level 0 Research for Outline):**
        Iterate through each major numbered or clearly delineated heading (e.g., H1, H2, H3, H4, or equivalent Markdown sections up to 3-4 levels deep) of the 'Primary Input Document'. For each heading:
        1.  **Heading Context Analysis:** Read text under the current heading; list initial research topics/keywords.
        2.  **Supporting Docs Analysis (Contextual):** Review docs in `PRODUCT_SPECS_INPUT_DOCS_PATH` relevant to the current heading; list additional topics.
        3.  **References & Codebase Analysis (Contextual & Controlled):**
            *   **Document References:** Follow explicit inter-document references (within provided input/guidance sets) as per `Max_Ref_Depth`. Analyze for relevance.
            *   **Codebase References:** If links to codebases/files are found:
                *   Fetch text content (e.g., via `view_text_website`). Note if inaccessible.
                *   Review per `Code_Review_Preference` and `PRODUCT_SPECS_CODEBASE_FOCUS_AREAS`.
                *   **Level 0 Code Analysis ONLY:** Confine analysis to directly fetched text. **Do NOT follow internal code references (imports, calls to other files not in current text).**
                *   Summarize findings, noting preference and limitations.
            *   List additional research topics from references.
        4.  **Consolidated Research Execution (Current Heading):** Perform consolidated research on topics for the current heading, using all provided documents (original inputs, guidance, referenced docs). Do not seek external information.
        5.  **Content Contribution (Iterative - Outline for Current Heading):**
            *   **Output Constraint for Depth 0:** For the current heading (and any sub-headings identified within it down to 3-4 levels), generate ONLY:
                *   The Heading Title itself (maintaining its level).
                *   A single paragraph summarizing the key ideas, purpose, or main points relevant to this heading, based on your research for this heading.
            *   Store this drafted outline content iteratively.

**B. If `Current_Iteration_Depth` is 1 ("Basic Content - Bachelor's Level"):**

    **i. Iterative Elaboration from D0 Outline:**
        For each heading and its corresponding key ideas paragraph in the `*_D0.md` documents (read from `Previous_Iteration_Path`):
        1.  **Expand Content:** Elaborate on the D0 key ideas paragraph to approximately 3 well-developed paragraphs.
        2.  **Detail Level:** Content should introduce and explain specific concepts, ideas, algorithms (if applicable), examples, and relevant names or terminology associated with the heading's topic. Aim for a level of detail and explanation akin to a "Bachelor's Degree Education" on the subject of that heading.
        3.  **Reference Original Inputs:** You MAY refer back to the original documents in `PRODUCT_SPECS_INPUT_DOCS_PATH` and `PRODUCT_SPECS_GUIDANCE_DOCS_PATH`, and perform focused re-analysis of specific sections if necessary to achieve this depth of content for the D1 output. Adhere to `Max_Ref_Depth` for any new document-to-document links explored and `Code_Review_Preference` for any new code links.
        4.  Store this elaborated content iteratively.

**C. If `Current_Iteration_Depth` is 2 ("Expert Elaboration"):**

    **i. Iterative Elaboration from D1 Content:**
        For each major section corresponding to an *original major heading* from the Primary Input Document (now elaborated in the `*_D1.md` documents from `Previous_Iteration_Path`):
        1.  **Identify Key Aspects:** Review the D1 content for that major section and identify the key aspects, concepts, and components discussed.
        2.  **Deepen Elaboration:** Elaborate significantly on these aspects to an "expert level." This involves providing more in-depth analysis, discussing nuances, exploring implications, comparing alternatives (if relevant from source materials), and offering more comprehensive explanations.
        3.  **Target Length/Density:** Aim for a target length equivalent to approximately 1 full page of 10pt single-spaced text (around 500-600 words, or equivalent information density) for each original major heading's expanded section.
        4.  **Reference Original Inputs:** You MAY refer back to original documents and guidance for deeper insights or to ensure all relevant details are captured.
        5.  Store this expert-level content iteratively.

**D. If `Current_Iteration_Depth` is 3 ("AI Unique Insights"):**

    **i. Iterative Elaboration from D2 Content:**
        For each major section corresponding to an *original major heading* from the Primary Input Document (now elaborated in the `*_D2.md` documents from `Previous_Iteration_Path`):
        1.  **Synthesize D2 Content:** Thoroughly understand the expert-level elaboration provided in D2.
        2.  **Generate Unique Insights:** Expand significantly upon the D2 content. Focus on generating "unique insights that only an AI may be able to extract from the depth and volume of information available to it through all researched materials (original inputs, guidance, and previous iteration documents)." This could include:
            *   Identifying subtle patterns or connections.
            *   Proposing novel ideas or innovative approaches based on the synthesized knowledge.
            *   Performing critical analysis of trade-offs, potential risks, or hidden assumptions.
            *   Identifying potential gaps in the existing information or suggesting new avenues for exploration.
        3.  **Target Length/Density:** Aim for a target length of at least 3 full pages (around 1500-1800 words, or equivalent information density) for each original major heading's expanded section.
        4.  Store this insight-rich content iteratively.

**E. General Instructions for Iterations 1, 2, & 3:**
    *   **Build Upon Previous Work:** Your primary task is to build upon, expand, and deepen the content from the documents provided via `PRODUCT_SPECS_PREVIOUS_ITERATION_OUTPUT_PATH`. Do not simply repeat information or regenerate content from scratch as if it were Depth 0.
    *   **Maintain Consistency:** Ensure consistency in style, terminology, and overall structure with the documents from the previous iteration. Ensure smooth transitions and logical flow between previously existing content and newly added elaborations.
    *   **Indicate Iteration Depth:** While filename conventions will denote the depth, you may also include a brief introductory note in each document specifying the iteration depth it represents (e.g., "This document represents Depth 1: Basic Content elaboration...").

---
### Phase 4: Decision Making and Document Structure Finalization

This phase adapts based on `Current_Iteration_Depth`.

*   **For `Current_Iteration_Depth` 0:**
    1.  **Formulate Specification Structure:** Review the iteratively drafted outline content from Phase 3.A. Based on this and guidance documents, finalize the key sections for `{PRODUCT_NAME}_product_specification_D0.md`.
    2.  **Draft Requirements List Structure:** Plan the initial structure for `{PRODUCT_NAME}_product_requirements_D0.md` based on themes from Phase 3.A.
    3.  **Determine Need for Architectural Specification:** Evaluate if an architectural specification is warranted (as per original guideline). If so, plan its outline for `{PRODUCT_NAME}_architectural_specification_D0.md`.
*   **For `Current_Iteration_Depth` 1, 2, or 3:**
    1.  The overall document structure (which documents to produce: spec, reqs, and optionally arch) is typically defined by Depth 0. For these higher depths, review the elaborated content from Phase 3 (B, C, or D) and ensure it logically fits within the established document structures.
    2.  Refine requirements in `{PRODUCT_NAME}_product_requirements_D[current_depth].md` based on new elaborations.
    3.  If new insights significantly impact the decision for an architectural spec, or its content, make necessary adjustments.

---
### Phase 5: Output Document Assembly and Finalization

Assemble the complete versions of the output documents using the content drafted/elaborated in Phase 3 and structured in Phase 4. Apply the correct depth suffix (`_D0`, `_D1`, `_D2`, or `_D3` as determined in Phase 1.4) to each filename. Review for coherence, consistency, formatting, and completeness. Adhere to guidelines from `PRODUCT_SPECS_GUIDANCE_DOCS_PATH`.

1.  **`{PRODUCT_NAME}_product_specification_[SUFFIX].md`**
2.  **`{PRODUCT_NAME}_product_requirements_[SUFFIX].md`**
3.  **`{PRODUCT_NAME}_architectural_specification_[SUFFIX].md` (Conditional)** (Generate if decided in Phase 4)

    (Refer to original suggested outlines in the previous version of this prompt for general structure of these documents, adapting content based on the current iteration's depth and focus.)

---
### Phase 6: Finalization and Output

1.  **Save Documents:** Save all generated Markdown documents to `PRODUCT_SPECS_OUTPUT_PATH`.
2.  **Report Completion:** State "Build Product Specifications Process - Iteration Depth [Current_Iteration_Depth] complete." List full paths of generated documents. Note any unresolved ambiguities or critical errors encountered (e.g., missing previous iteration files).

---
### General Instructions for AI (Applicable to all Iteration Depths)

*   **Logical Flow and Traceability:** Maintain logical flow. Ensure decisions and specifications are traceable to input documents or guidance where possible, especially for Depth 0. Higher iterations should trace back to the previous iteration's content.
*   **Clarity and Conciseness:** All content should be clear, concise, and unambiguous for its intended depth.
*   **Handling Ambiguity:** If ambiguity cannot be resolved (respecting `Max_Ref_Depth` for docs, Level 0 for code), note this in an "Open Issues" section or final report. Do not invent information.
*   **Adherence to Guidance:** Strictly adhere to rules from `PRODUCT_SPECS_GUIDANCE_DOCS_PATH`.

[[END OF 'BUILD_PRODUCT_SPECS_PROCESS_ADDON' v0.2]]
